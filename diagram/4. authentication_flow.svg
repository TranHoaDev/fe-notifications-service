<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="899px" preserveAspectRatio="none" style="width:1355px;height:899px;background:#FFFFFF;" version="1.1" viewBox="0 0 1355 899" width="1355px" zoomAndPan="magnify"><defs/><g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="737.7891" width="8" x="24.2651" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="28" x2="28" y1="81.2969" y2="819.0859"/></g><g><title>TeamsController</title><rect fill="#000000" fill-opacity="0.00000" height="737.7891" width="8" x="242.3828" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="245.4585" x2="245.4585" y1="81.2969" y2="819.0859"/></g><g><title>TokenManager</title><rect fill="#000000" fill-opacity="0.00000" height="737.7891" width="8" x="571.0068" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="574.9683" x2="574.9683" y1="81.2969" y2="819.0859"/></g><g><title>Microsoft Graph</title><rect fill="#000000" fill-opacity="0.00000" height="737.7891" width="8" x="1118.813" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1121.9839" x2="1121.9839" y1="81.2969" y2="819.0859"/></g><g class="participant participant-head" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="5" y="77.9951">Client</text><ellipse cx="28.2651" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M28.2651,21.5 L28.2651,48.5 M15.2651,29.5 L41.2651,29.5 M28.2651,48.5 L15.2651,63.5 M28.2651,48.5 L41.2651,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="5" y="831.0811">Client</text><ellipse cx="28.2651" cy="842.8828" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M28.2651,850.8828 L28.2651,877.8828 M15.2651,858.8828 L41.2651,858.8828 M28.2651,877.8828 L15.2651,892.8828 M28.2651,877.8828 L41.2651,892.8828" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="TC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.8486" x="181.4585" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.8486" x="188.4585" y="69.9951">TeamsController</text></g><g class="participant participant-tail" data-participant="TC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.8486" x="181.4585" y="818.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.8486" x="188.4585" y="838.0811">TeamsController</text></g><g class="participant participant-head" data-participant="TM"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.0771" x="515.9683" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.0771" x="522.9683" y="69.9951">TokenManager</text></g><g class="participant participant-tail" data-participant="TM"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.0771" x="515.9683" y="818.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.0771" x="522.9683" y="838.0811">TokenManager</text></g><g class="participant participant-head" data-participant="MG"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125.6582" x="1059.9839" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.6582" x="1066.9839" y="69.9951">Microsoft Graph</text></g><g class="participant participant-tail" data-participant="MG"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125.6582" x="1059.9839" y="818.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.6582" x="1066.9839" y="838.0811">Microsoft Graph</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1348.3223" x="0" y="111.8633"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1348.3223" y1="111.8633" y2="111.8633"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1348.3223" y1="114.8633" y2="114.8633"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="179.166" x="584.5781" y="101.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160.6401" x="590.5781" y="117.3638">Manual Token Setting</text><g class="message" data-participant-1="C" data-participant-2="TC"><polygon fill="#181818" points="234.3828,151.5625,244.3828,155.5625,234.3828,159.5625,238.3828,155.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.2651" x2="240.3828" y1="155.5625" y2="155.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.8472" x="35.2651" y="150.4966">POST /auth/set-tokens</text></g><g class="message" data-participant-1="TC" data-participant-2="TM"><polygon fill="#181818" points="563.0068,183.6953,573.0068,187.6953,563.0068,191.6953,567.0068,187.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="246.3828" x2="569.0068" y1="187.6953" y2="187.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.624" x="253.3828" y="182.6294">setTokensDirectly(accessToken, refreshToken)</text></g><path d="M580,168.5625 L580,193.5625 L810,193.5625 L810,178.5625 L800,168.5625 L580,168.5625" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M800,168.5625 L800,178.5625 L810,178.5625 L800,168.5625" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.2632" x="586" y="185.6294">Store tokens with UTC timezone</text><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="575.0068" x2="617.0068" y1="219.8281" y2="219.8281"/><line style="stroke:#181818;stroke-width:1;" x1="617.0068" x2="617.0068" y1="219.8281" y2="232.8281"/><line style="stroke:#181818;stroke-width:1;" x1="576.0068" x2="617.0068" y1="232.8281" y2="232.8281"/><polygon fill="#181818" points="586.0068,228.8281,576.0068,232.8281,586.0068,236.8281,582.0068,232.8281" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.3965" x="582.0068" y="214.7622">extractExpiryFromToken()</text></g><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="575.0068" x2="617.0068" y1="261.9609" y2="261.9609"/><line style="stroke:#181818;stroke-width:1;" x1="617.0068" x2="617.0068" y1="261.9609" y2="274.9609"/><line style="stroke:#181818;stroke-width:1;" x1="576.0068" x2="617.0068" y1="274.9609" y2="274.9609"/><polygon fill="#181818" points="586.0068,270.9609,576.0068,274.9609,586.0068,278.9609,582.0068,274.9609" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="505.2163" x="582.0068" y="256.895">this.refreshTokenExpiry = LocalDateTime.now(ZoneOffset.UTC).plusDays(90)</text></g><g class="message" data-participant-1="TM" data-participant-2="TC"><polygon fill="#181818" points="257.3828,300.0938,247.3828,304.0938,257.3828,308.0938,253.3828,304.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="251.3828" x2="574.0068" y1="304.0938" y2="304.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50.8511" x="263.3828" y="299.0278">success</text></g><g class="message" data-participant-1="TC" data-participant-2="C"><polygon fill="#181818" points="39.2651,329.2266,29.2651,333.2266,39.2651,337.2266,35.2651,333.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="33.2651" x2="245.3828" y1="333.2266" y2="333.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.1089" x="45.2651" y="328.1606">"Tokens set successfully"</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1348.3223" x="0" y="361.793"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1348.3223" y1="361.793" y2="361.793"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1348.3223" y1="364.793" y2="364.793"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="189.4302" x="579.446" y="351.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="170.9043" x="585.446" y="367.2935">OAuth2 Code Exchange</text><g class="message" data-participant-1="C" data-participant-2="TC"><polygon fill="#181818" points="234.3828,401.4922,244.3828,405.4922,234.3828,409.4922,238.3828,405.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.2651" x2="240.3828" y1="405.4922" y2="405.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.1177" x="35.2651" y="400.4263">GET /auth/callback?code=xxx</text></g><g class="message" data-participant-1="TC" data-participant-2="TM"><polygon fill="#181818" points="563.0068,430.625,573.0068,434.625,563.0068,438.625,567.0068,434.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="246.3828" x2="569.0068" y1="434.625" y2="434.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.7451" x="253.3828" y="429.5591">exchangeCodeForToken(code)</text></g><g class="message" data-participant-1="TM" data-participant-2="MG"><polygon fill="#181818" points="1110.813,462.7578,1120.813,466.7578,1110.813,470.7578,1114.813,466.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="575.0068" x2="1116.813" y1="466.7578" y2="466.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.4873" x="582.0068" y="461.6919">POST /oauth2/v2.0/token</text></g><path d="M1127,447.625 L1127,472.625 L1337,472.625 L1337,457.625 L1327,447.625 L1127,447.625" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1327,447.625 L1327,457.625 L1337,457.625 L1327,447.625" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.5093" x="1133" y="464.6919">Exchange authorization code</text><g class="message" data-participant-1="MG" data-participant-2="TM"><polygon fill="#181818" points="586.0068,494.8906,576.0068,498.8906,586.0068,502.8906,582.0068,498.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="580.0068" x2="1121.813" y1="498.8906" y2="498.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.6797" x="592.0068" y="493.8247">TokenResponse</text></g><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="575.0068" x2="617.0068" y1="528.0234" y2="528.0234"/><line style="stroke:#181818;stroke-width:1;" x1="617.0068" x2="617.0068" y1="528.0234" y2="541.0234"/><line style="stroke:#181818;stroke-width:1;" x1="576.0068" x2="617.0068" y1="541.0234" y2="541.0234"/><polygon fill="#181818" points="586.0068,537.0234,576.0068,541.0234,586.0068,545.0234,582.0068,541.0234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.7129" x="582.0068" y="522.9575">updateTokens(response)</text></g><path d="M755.7129,515.3906 L755.7129,540.3906 L989.7129,540.3906 L989.7129,525.3906 L979.7129,515.3906 L755.7129,515.3906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M979.7129,515.3906 L979.7129,525.3906 L989.7129,525.3906 L979.7129,515.3906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.4082" x="761.7129" y="532.4575">UTC timezone for all timestamps</text><g class="message" data-participant-1="TM" data-participant-2="TC"><polygon fill="#181818" points="257.3828,566.1563,247.3828,570.1563,257.3828,574.1563,253.3828,570.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="251.3828" x2="574.0068" y1="570.1563" y2="570.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.6797" x="263.3828" y="565.0903">TokenResponse</text></g><g class="message" data-participant-1="TC" data-participant-2="C"><polygon fill="#181818" points="39.2651,595.2891,29.2651,599.2891,39.2651,603.2891,35.2651,599.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="33.2651" x2="245.3828" y1="599.2891" y2="599.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8008" x="45.2651" y="594.2231">"Authentication successful"</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1348.3223" x="0" y="627.8555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1348.3223" y1="627.8555" y2="627.8555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1348.3223" y1="630.8555" y2="630.8555"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="163.6143" x="592.354" y="617.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145.0884" x="598.354" y="633.356">Token Status Check</text><g class="message" data-participant-1="C" data-participant-2="TC"><polygon fill="#181818" points="234.3828,667.5547,244.3828,671.5547,234.3828,675.5547,238.3828,671.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.2651" x2="240.3828" y1="671.5547" y2="671.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.8828" x="35.2651" y="666.4888">GET /token/status</text></g><g class="message" data-participant-1="TC" data-participant-2="TM"><polygon fill="#181818" points="563.0068,696.6875,573.0068,700.6875,563.0068,704.6875,567.0068,700.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="246.3828" x2="569.0068" y1="700.6875" y2="700.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.5757" x="253.3828" y="695.6216">getTokenStatus()</text></g><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="575.0068" x2="617.0068" y1="729.8203" y2="729.8203"/><line style="stroke:#181818;stroke-width:1;" x1="617.0068" x2="617.0068" y1="729.8203" y2="742.8203"/><line style="stroke:#181818;stroke-width:1;" x1="576.0068" x2="617.0068" y1="742.8203" y2="742.8203"/><polygon fill="#181818" points="586.0068,738.8203,576.0068,742.8203,586.0068,746.8203,582.0068,742.8203" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="533.8062" x="582.0068" y="724.7544">ChronoUnit.MINUTES.between(LocalDateTime.now(ZoneOffset.UTC), tokenExpiry)</text></g><g class="message" data-participant-1="TM" data-participant-2="TC"><polygon fill="#181818" points="257.3828,767.9531,247.3828,771.9531,257.3828,775.9531,253.3828,771.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="251.3828" x2="574.0068" y1="771.9531" y2="771.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.085" x="263.3828" y="766.8872">TokenStatus</text></g><g class="message" data-participant-1="TC" data-participant-2="C"><polygon fill="#181818" points="39.2651,797.0859,29.2651,801.0859,39.2651,805.0859,35.2651,801.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="33.2651" x2="245.3828" y1="801.0859" y2="801.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.7393" x="45.2651" y="796.02">TokenStatus with UTC times</text></g><!--SRC=[XPDFZvim4CNlV8fHJa7Qa5LkZKfN5ScYIgMf6dBfpUiTWXLY8tjeo7xw-azeO7lO8-FdD_D-7XWdfI5h14e2PY2BMgP9SD4oMvYLoCucKvAqQXhKCoSftslK2MN193iEWc8gA0JNogYA8DUihRscoACeJS5UwrW3tWBsI2Ja4T8qoc3nnJPQmy_TleGbwwXU6gG5EQ69od1UhC4M_MMp4HevDTSvunoDySK7q5XfDBN_YYEf246BOqrhsDlS2C4FBe9gE5XN4cTyKnAZiXWwO4-QSThshT3NPwtEtcmUZoHK2vECMmKnfF1TSTPi665fZHEfBlFVrdrNLNRkn3QCaxRfp8PTpVpJO-noVLw4N9sF4OM21H4m6nTuEAowfhdEFCVTLqje1PbwHTZsl6RoY1EE-NR0Q0TgNXW_FN4hJlk-7z74srNdywnqIEfqGzeY7vv4ERFLyiygULnwYXEw_sPmAgN56oEX93YhgCY7Tjx_5vfMIJD6thMl3faFFDUty-dpZHyBAhl2DfKl66Bdren8JflSUJfYTka53wFTcGQYjvKaHftzAshaf_zv-jnBupKZYiVRJeRBaqt9QgsaEaX1IV7jnw7SxfCNf0jQp1-koaFOrh1RyVk4eTaztwWuNM_p5m00]--></g></svg>