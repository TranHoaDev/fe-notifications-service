<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="825px" preserveAspectRatio="none" style="width:1451px;height:825px;background:#FFFFFF;" version="1.1" viewBox="0 0 1451 825" width="1451px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="419.2031" style="stroke:#000000;stroke-width:1.5;" width="1434.0557" x="10" y="185.6953"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="663.1328" width="8" x="39.2651" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="81.2969" y2="744.4297"/></g><g><title>TeamsController</title><rect fill="#000000" fill-opacity="0.00000" height="663.1328" width="8" x="315.6416" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="318.7173" x2="318.7173" y1="81.2969" y2="744.4297"/></g><g><title>TeamsGraphClient</title><rect fill="#000000" fill-opacity="0.00000" height="663.1328" width="8" x="536.5967" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="540.522" x2="540.522" y1="81.2969" y2="744.4297"/></g><g><title>TokenManager</title><rect fill="#000000" fill-opacity="0.00000" height="663.1328" width="8" x="906.1313" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="910.0928" x2="910.0928" y1="81.2969" y2="744.4297"/></g><g><title>Microsoft Graph</title><rect fill="#000000" fill-opacity="0.00000" height="663.1328" width="8" x="1196.4854" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1199.6563" x2="1199.6563" y1="81.2969" y2="744.4297"/></g><g class="participant participant-head" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="20" y="77.9951">Client</text><ellipse cx="43.2651" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43.2651,21.5 L43.2651,48.5 M30.2651,29.5 L56.2651,29.5 M43.2651,48.5 L30.2651,63.5 M43.2651,48.5 L56.2651,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="20" y="756.4248">Client</text><ellipse cx="43.2651" cy="768.2266" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43.2651,776.2266 L43.2651,803.2266 M30.2651,784.2266 L56.2651,784.2266 M43.2651,803.2266 L30.2651,818.2266 M43.2651,803.2266 L56.2651,818.2266" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="TC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.8486" x="254.7173" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.8486" x="261.7173" y="69.9951">TeamsController</text></g><g class="participant participant-tail" data-participant="TC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.8486" x="254.7173" y="743.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.8486" x="261.7173" y="763.4248">TeamsController</text></g><g class="participant participant-head" data-participant="TGC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144.1494" x="468.522" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.1494" x="475.522" y="69.9951">TeamsGraphClient</text></g><g class="participant participant-tail" data-participant="TGC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144.1494" x="468.522" y="743.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.1494" x="475.522" y="763.4248">TeamsGraphClient</text></g><g class="participant participant-head" data-participant="TM"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.0771" x="851.0928" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.0771" x="858.0928" y="69.9951">TokenManager</text></g><g class="participant participant-tail" data-participant="TM"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.0771" x="851.0928" y="743.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.0771" x="858.0928" y="763.4248">TokenManager</text></g><g class="participant participant-head" data-participant="MG"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125.6582" x="1137.6563" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.6582" x="1144.6563" y="69.9951">Microsoft Graph</text></g><g class="participant participant-tail" data-participant="MG"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125.6582" x="1137.6563" y="743.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.6582" x="1144.6563" y="763.4248">Microsoft Graph</text></g><g class="message" data-participant-1="C" data-participant-2="TC"><polygon fill="#181818" points="307.6416,108.4297,317.6416,112.4297,307.6416,116.4297,311.6416,112.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="43.2651" x2="313.6416" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1538" x="50.2651" y="107.3638">POST /send-message</text></g><g class="message" data-participant-1="TC" data-participant-2="TGC"><polygon fill="#181818" points="528.5967,137.5625,538.5967,141.5625,528.5967,145.5625,532.5967,141.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="319.6416" x2="534.5967" y1="141.5625" y2="141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.9551" x="326.6416" y="136.4966">sendMessage(chatId, content)</text></g><g class="message" data-participant-1="TGC" data-participant-2="TM"><polygon fill="#181818" points="898.1313,166.6953,908.1313,170.6953,898.1313,174.6953,902.1313,170.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="540.5967" x2="904.1313" y1="170.6953" y2="170.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.3345" x="547.5967" y="165.6294">getDelegatedToken()</text></g><path d="M10,185.6953 L74.4429,185.6953 L74.4429,192.8281 L64.4429,202.8281 L10,202.8281 L10,185.6953" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="419.2031" style="stroke:#000000;stroke-width:1.5;" width="1434.0557" x="10" y="185.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="198.7622">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="82.9028" x="89.4429" y="197.9058">[Token Valid]</text><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="910.1313" x2="952.1313" y1="223.9609" y2="223.9609"/><line style="stroke:#181818;stroke-width:1;" x1="952.1313" x2="952.1313" y1="223.9609" y2="236.9609"/><line style="stroke:#181818;stroke-width:1;" x1="911.1313" x2="952.1313" y1="236.9609" y2="236.9609"/><polygon fill="#181818" points="921.1313,232.9609,911.1313,236.9609,921.1313,240.9609,917.1313,236.9609" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.5234" x="917.1313" y="218.895">isTokenValid()</text></g><path d="M1021.5234,211.3281 L1021.5234,236.3281 L1428.5234,236.3281 L1428.5234,221.3281 L1418.5234,211.3281 L1021.5234,211.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1418.5234,211.3281 L1418.5234,221.3281 L1428.5234,221.3281 L1418.5234,211.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386.4009" x="1027.5234" y="228.395">LocalDateTime.now(ZoneOffset.UTC).isBefore(tokenExpiry)</text><g class="message" data-participant-1="TM" data-participant-2="TGC"><polygon fill="#181818" points="551.5967,262.0938,541.5967,266.0938,551.5967,270.0938,547.5967,266.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="545.5967" x2="909.1313" y1="266.0938" y2="266.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.481" x="557.5967" y="261.0278">return delegatedToken</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1444.0557" y1="275.0938" y2="275.0938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="236.1724" x="15" y="285.3042">[Token Expired but Refresh Available]</text><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="910.1313" x2="952.1313" y1="310.0313" y2="310.0313"/><line style="stroke:#181818;stroke-width:1;" x1="952.1313" x2="952.1313" y1="310.0313" y2="323.0313"/><line style="stroke:#181818;stroke-width:1;" x1="911.1313" x2="952.1313" y1="323.0313" y2="323.0313"/><polygon fill="#181818" points="921.1313,319.0313,911.1313,323.0313,921.1313,327.0313,917.1313,323.0313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.1191" x="917.1313" y="304.9653">canRefreshToken()</text></g><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="910.1313" x2="952.1313" y1="352.1641" y2="352.1641"/><line style="stroke:#181818;stroke-width:1;" x1="952.1313" x2="952.1313" y1="352.1641" y2="365.1641"/><line style="stroke:#181818;stroke-width:1;" x1="911.1313" x2="952.1313" y1="365.1641" y2="365.1641"/><polygon fill="#181818" points="921.1313,361.1641,911.1313,365.1641,921.1313,369.1641,917.1313,365.1641" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.8101" x="917.1313" y="347.0981">refreshAccessToken()</text></g><g class="message" data-participant-1="TM" data-participant-2="MG"><polygon fill="#181818" points="1188.4854,390.2969,1198.4854,394.2969,1188.4854,398.2969,1192.4854,394.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="910.1313" x2="1194.4854" y1="394.2969" y2="394.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.354" x="917.1313" y="389.231">POST /oauth2/v2.0/token (refresh_token)</text></g><g class="message" data-participant-1="MG" data-participant-2="TM"><polygon fill="#181818" points="921.1313,419.4297,911.1313,423.4297,921.1313,427.4297,917.1313,423.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="915.1313" x2="1199.4854" y1="423.4297" y2="423.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.6816" x="927.1313" y="418.3638">new TokenResponse</text></g><g class="message" data-participant-1="TM" data-participant-2="TM"><line style="stroke:#181818;stroke-width:1;" x1="910.1313" x2="952.1313" y1="452.5625" y2="452.5625"/><line style="stroke:#181818;stroke-width:1;" x1="952.1313" x2="952.1313" y1="452.5625" y2="465.5625"/><line style="stroke:#181818;stroke-width:1;" x1="911.1313" x2="952.1313" y1="465.5625" y2="465.5625"/><polygon fill="#181818" points="921.1313,461.5625,911.1313,465.5625,921.1313,469.5625,917.1313,465.5625" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.7598" x="917.1313" y="447.4966">updateTokens() with UTC</text></g><g class="message" data-participant-1="TM" data-participant-2="TGC"><polygon fill="#181818" points="551.5967,490.6953,541.5967,494.6953,551.5967,498.6953,547.5967,494.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="545.5967" x2="909.1313" y1="494.6953" y2="494.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.4829" x="557.5967" y="489.6294">return new delegatedToken</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1444.0557" y1="503.6953" y2="503.6953"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110.043" x="15" y="513.9058">[No Valid Tokens]</text><g class="message" data-participant-1="TM" data-participant-2="TGC"><polygon fill="#181818" points="551.5967,534.6328,541.5967,538.6328,551.5967,542.6328,547.5967,538.6328" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="545.5967" x2="909.1313" y1="538.6328" y2="538.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345.5347" x="557.5967" y="533.5669">throw TokenException(AUTHENTICATION_REQUIRED)</text></g><g class="message" data-participant-1="TGC" data-participant-2="TC"><polygon fill="#181818" points="330.6416,563.7656,320.6416,567.7656,330.6416,571.7656,326.6416,567.7656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="324.6416" x2="539.5967" y1="567.7656" y2="567.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.8667" x="336.6416" y="562.6997">TokenException</text></g><g class="message" data-participant-1="TC" data-participant-2="C"><polygon fill="#181818" points="54.2651,592.8984,44.2651,596.8984,54.2651,600.8984,50.2651,596.8984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48.2651" x2="318.6416" y1="596.8984" y2="596.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.3765" x="60.2651" y="591.8325">401 Unauthorized + Authorization URL</text></g><g class="message" data-participant-1="TGC" data-participant-2="MG"><polygon fill="#181818" points="1188.4854,632.0313,1198.4854,636.0313,1188.4854,640.0313,1192.4854,636.0313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="540.5967" x2="1194.4854" y1="636.0313" y2="636.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.0347" x="547.5967" y="630.9653">POST /chats/{chatId}/messages</text></g><path d="M1205,616.8984 L1205,641.8984 L1424,641.8984 L1424,626.8984 L1414,616.8984 L1205,616.8984" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1414,616.8984 L1414,626.8984 L1424,626.8984 L1414,616.8984" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.3833" x="1211" y="633.9653">Bearer token + message body</text><g class="message" data-participant-1="MG" data-participant-2="TGC"><polygon fill="#181818" points="551.5967,664.1641,541.5967,668.1641,551.5967,672.1641,547.5967,668.1641" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="545.5967" x2="1199.4854" y1="668.1641" y2="668.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="557.5967" y="663.0981">200 OK</text></g><g class="message" data-participant-1="TGC" data-participant-2="TC"><polygon fill="#181818" points="330.6416,693.2969,320.6416,697.2969,330.6416,701.2969,326.6416,697.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="324.6416" x2="539.5967" y1="697.2969" y2="697.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50.8511" x="336.6416" y="692.231">success</text></g><g class="message" data-participant-1="TC" data-participant-2="C"><polygon fill="#181818" points="54.2651,722.4297,44.2651,726.4297,54.2651,730.4297,50.2651,726.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48.2651" x2="318.6416" y1="726.4297" y2="726.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.8916" x="60.2651" y="721.3638">"Message sent successfully"</text></g><!--SRC=[TLDDSzem5BphLxpXP2ODKAOd3fqXXd6Pnj1IEuTSCi9-nfeAoIF98RIJ_rvzs2dGL3TfzwtshPveOQI2c3CK1gY6c3HK6LQmXjg3GORqe6CfZ9ASeneuIlOU9r6qgODC82NNBFaJHKe5tVSowIKXPOMIMbO6l9Rdf0aXCTn-jdVEuDlcHmPZZQAyFQ3MLeXa0KmiwixJS1mLDJMhyWCKrhWrD2IMuOdf3FPe5iXnJmsMtbCq98Ho0tu33vIpae1TMTgNCEqn3rcs0uKq28hjQpE3UrbGlh1w6JlWICXZz2W5RgfAendbMJmSCNs7bLGO6QUpV6cOEWtFBt4DA3Ij4b1Uc2F8DNRMV1sMi6iDRB5Ig6kOFrF6wOxZbUM2YexIztY9gm3EYy96zYybJVgu9MrDFHq_JqUJiNSFKLVxvBUXAarwOO77O7UBkf52Nnjhcz8bvHWw6iAHcHfiHly9mwcz5yXQXeSAL-dhQbChsTbOlXJO62P5DC-pByjrjehdsMgpVjekl-UhxNBHjPsyZTbbMK0zQB5Fau-G2nU9LEoNVOiRc7SRwjYGR- -97KJIJzpV8DrCwl7lC9glusw2DJcVf3ka2XM4d6-Wuy1EbYVIHUpQcquciFbApZphrZyaUJCwwBw2-nQcXwkMyzFW3m00]--></g></svg>